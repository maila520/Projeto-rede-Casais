<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="google" content="notranslate">
  <title>Encontro de Casais ğŸ’ - VotaÃ§Ã£o</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap');

  body {
    font-family: 'Montserrat', sans-serif;
    background: linear-gradient(to bottom right, #3b0a16, #6d1a2d);
    color: #fff;
    margin: 0;
    padding: 0;
    text-align: center;
  }

  h1 {
    color: #ffdde5;
    font-size: 2.6em;
    margin-top: 25px;
    font-weight: 700;
    text-shadow: 1px 1px 6px rgba(0, 0, 0, 0.4);
  }

  form {
    background: #fff;
    margin: 30px auto;
    padding: 35px;
    border-radius: 20px;
    max-width: 580px;
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.35);
    border: 3px solid #6d1a2d;
    color: #3b0a16;
    font-size: 1.1em;
    text-align: left;
  }

  .campo {
    margin-bottom: 18px;
  }

  label {
    display: block;
    font-weight: 600;
    margin-bottom: 6px;
    color: #3b0a16;
  }

  select,
  button {
    width: 100%;
    padding: 14px;
    border: 2px solid #6d1a2d;
    border-radius: 10px;
    font-size: 1.05em;
    font-weight: 500;
    background: #fff;
    color: #3b0a16;
    transition: all 0.3s ease;
    box-sizing: border-box;
  }

  select:focus {
    outline: none;
    border-color: #9c2740;
    box-shadow: 0 0 8px rgba(156, 39, 64, 0.5);
  }

  button {
    background-color: #6d1a2d;
    color: white;
    cursor: pointer;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    transition: all 0.3s ease;
  }

  button:hover {
    background-color: #9c2740;
    transform: scale(1.04);
    box-shadow: 0 4px 15px rgba(156, 39, 64, 0.4);
  }

  .resultados {
    background: #fff;
    margin: 35px auto;
    padding: 30px;
    border-radius: 20px;
    max-width: 580px;
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.35);
    border: 3px solid #6d1a2d;
    color: #3b0a16;
    font-size: 1.15em;
  }

  h2 {
    color: #6d1a2d;
    font-size: 1.8em;
    margin-bottom: 15px;
    font-weight: 700;
    text-align: center;
  }

  ul {
    list-style: none;
    padding: 0;
    font-size: 1.05em;
  }

  li {
    padding: 10px;
    border-bottom: 1px solid #f3ccd2;
  }

  footer {
    margin-top: 40px;
    padding: 15px;
    background-color: #3b0a16;
    color: #ffdde5;
    font-size: 1.1em;
    letter-spacing: 0.5px;
    text-align: center;
  }

  .modal-backdrop {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.7);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 1000;
  }

  .modal {
    background: #4a0e1f;
    padding: 40px;
    border-radius: 16px;
    width: 90%;
    max-width: 620px;
    box-shadow: 0 10px 35px rgba(0, 0, 0, 0.6);
    text-align: center;
    border: 2px solid #fff;
    color: #fff;
  }

  .modal h3 {
    margin-top: 0;
    color: #fff;
    font-size: 2em;
    font-weight: 700;
  }

  .modal p {
    color: #ffe5ec;
    font-size: 1.25em;
    margin-top: 10px;
    font-weight: 500;
  }

  .modal input {
    width: 100%;
    padding: 14px;
    margin-top: 18px;
    border-radius: 8px;
    border: 2px solid #fff;
    background: #fff;
    font-size: 1.1em;
    color: #4a0e23;
    transition: 0.3s;
    font-family: 'Montserrat', sans-serif;
  }

  .modal .actions {
    margin-top: 25px;
    text-align: center;
  }

  .modal .actions button {
    background-color: #fff;
    color: #6d1a2d;
    border: none;
    padding: 12px 28px;
    border-radius: 10px;
    font-size: 1.05em;
    cursor: pointer;
    transition: 0.3s;
    font-weight: 600;
  }

  .modal .actions button:hover {
    background-color: #ffdde5;
    color: #3b0a16;
    transform: scale(1.05);
  }

  @media (max-width: 600px) {
    h1 { font-size: 2.1em; }
    form, .resultados { padding: 25px; font-size: 1em; }
    .modal { padding: 30px; max-width: 90%; }
    .modal h3 { font-size: 1.6em; }
    .modal p, button, select { font-size: 1em; }
  }
</style>
</head>

<body>
  <h1>ğŸ’– VotaÃ§Ã£o - Encontro de Casais ğŸ’–</h1>

  <form id="formVotacao">
    <div class="campo">
      <label>Selecione seu casal ğŸ’‘</label>
      <select id="nomeVotante" required></select>
    </div>

    <div class="campo"><label>Casal mais animado ğŸ˜‚</label><select id="animado"></select></div>
    <div class="campo"><label>Casal mais unido em tudo ğŸ¤</label><select id="unido"></select></div>
    <div class="campo"><label>Casal mais tranquilo e sereno ğŸ˜Œ</label><select id="tranquilo"></select></div>
    <div class="campo"><label>Casal mais sorridente ğŸ˜„</label><select id="sorridente"></select></div>
    <div class="campo"><label>Casal mais carinhoso ğŸ’</label><select id="carinhoso"></select></div>
    <div class="campo"><label>Casal mais inspirador ğŸŒŸ</label><select id="inspiracao"></select></div>
    <div class="campo"><label>Casal mais apaixonado ğŸ’</label><select id="apaixonado"></select></div>
    <div class="campo"><label>Casal que mais demonstra fÃ© ğŸ™</label><select id="fe"></select></div>
    <div class="campo"><label>Casal que mais se completa â¤ï¸</label><select id="completa"></select></div>
    <div class="campo"><label>Casal mais comunicativo ğŸ—£ï¸</label><select id="comunicativo"></select></div>
    <div class="campo"><label>Casal superaÃ§Ã£o (venceu desafios juntos) ğŸ’ª</label><select id="superacao"></select></div>
    <div class="campo"><label>Casal mais elegante ğŸ’ƒğŸ•º</label><select id="elegante"></select></div>
    <div class="campo"><label>Casal mais romÃ¢ntico ğŸ’‹</label><select id="romantico"></select></div>
    <div class="campo"><label>Casal mais acolhedor ğŸ¤—</label><select id="acolhedor"></select></div>
    <div class="campo"><label>Casal mais harmonia com todos ğŸ¤</label><select id="harmonia"></select></div>
    <div class="campo"><label>Casal mais engraÃ§ado ğŸ˜‚</label><select id="engraÃ§ado"></select></div>

    <button type="submit">Enviar Voto ğŸ’Œ</button>
  </form>

  <div class="resultados" id="divRanking">
    <h2>ğŸ† Ranking dos Casais Mais Votados</h2>
    <ul id="ranking"></ul>
  </div>

  <div class="resultados" id="divVotantes">
    <h2>ğŸ“ Quem JÃ¡ Votou</h2>
    <ul id="votantes"></ul>
  </div>

  <footer>Feito com ğŸ’• para o Encontro de Casais da Igreja IBVA</footer>

  <!-- Modal -->
  <div class="modal-backdrop" id="pwModal">
    <div class="modal">
      <h3>Acesso restrito</h3>
      <p>Digite a senha para visualizar o ranking e a lista de votantes.</p>
      <input id="pwInput" type="password" placeholder="Senha" />
      <div class="actions">
        <button id="pwCancel" type="button">Cancelar</button>
        <button id="pwSubmit" type="button">Entrar</button>
      </div>
    </div>
  </div>

  <script>
    const casais = [
      "Elmano e Ana","Joabe e Gleide","SalomÃ£o e Nildete","Bonfim e Celma",
      "Marcio e Eliene","Eric e Andreara","Luciano e Evelin","Leonardo e Adriana",
      "Lindomar e Paula","MarcÃ£o e Viviane","Frances e Silvana","Jaciano e Patricia",
      "Nailton e Jacira","FÃ¡bio e Marlene","Elisangela e Claudio","NatÃ£ e Maila",
      "Deri e Naiana","Paulo e Giselia","Tony e Adriana","Mateus e Barbara",
      "Silvio e Jeane","Elmo e Talita","Moises e Joice","Uelington e Lve",
      "Beto e Lais","Adilma e AndrÃ©","Giliane e Roberto","Sheila e Esposo",
      "Gomes e GraÃ§a","AntÃ´nio e Jucineide","Alex e LÃºcia"
    ];

    const categorias = ["animado","unido","tranquilo","sorridente","carinhoso","inspiracao","apaixonado","fe","completa","comunicativo","superacao","elegante","romantico","acolhedor","harmonia","engraÃ§ado"];

    const casaisAutorizados = ["NatÃ£ e Maila", "Joabe e Gleide"];
    const SENHA = "cafeteira";
    const API_KEY = "$2a$10$5MkP8u/0Aw44UKNpoB8BUOkAkRPRGOtsLwnCui5hJnuWP8ZeIbv9.";
    const BIN_ID  = "690cec3bd0ea881f40d8478b";

    async function carregarVotos() {
      try {
        const res = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, { headers: { "X-Master-Key": API_KEY } });
        const data = await res.json();
        return data.record || { votos: [], votantes: [] };
      } catch {
        return { votos: [], votantes: [] };
      }
    }

    async function salvarVotos(votos, votantes) {
      try {
        await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
          method: "PUT",
          headers: { "Content-Type": "application/json", "X-Master-Key": API_KEY },
          body: JSON.stringify({ votos, votantes })
        });
        return true;
      } catch {
        return false;
      }
    }

    function preencherSelects() {
      const selVotante = document.getElementById("nomeVotante");
      let oPadrao = document.createElement("option");
      oPadrao.value = "";
      oPadrao.textContent = "-- Selecione seu casal --";
      oPadrao.disabled = true;
      oPadrao.selected = true;
      selVotante.appendChild(oPadrao);
      casais.forEach(c => {
        let o = document.createElement("option");
        o.value = c;
        o.textContent = c;
        selVotante.appendChild(o);
      });

      categorias.forEach(cat=>{
        let sel=document.getElementById(cat);
        let p=document.createElement("option");
        p.value="";p.textContent="-- Escolha um casal --";p.disabled=true;p.selected=true;
        sel.appendChild(p);
        casais.forEach(c=>{let o=document.createElement("option");o.value=c;o.textContent=c;sel.appendChild(o);});
      });
    }

    function atualizarOpcoesParaVotante(v) {
      categorias.forEach(cat=>{
        let s=document.getElementById(cat);
        for(let i=0;i<s.options.length;i++){
          let o=s.options[i];
          if(o.value==v){o.disabled=true;if(s.value==o.value)s.value="";}
          else o.disabled=false;
        }
      });
    }

    function atualizarListas(votos,votantes){
      const r=document.getElementById("ranking"),v=document.getElementById("votantes");
      const cont={};
      votos.forEach(x=>{Object.values(x).forEach(n=>{if(!n)return;cont[n]=(cont[n]||0)+1;});});
      r.innerHTML=Object.entries(cont).sort((a,b)=>b[1]-a[1]).map(([n,q])=>`<li><b>${n}</b> - ${q} votos</li>`).join("")||"<li>Nenhum voto ainda ğŸ’­</li>";
      v.innerHTML=votantes.length?votantes.map(v=>`<li>${v}</li>`).join(""):"<li>NinguÃ©m votou ainda ğŸ’Œ</li>";
    }

    function podeVerResultados(nome){
      return casaisAutorizados.includes(nome)&&sessionStorage.getItem("auth_"+nome)==="1";
    }

    function atualizarVisibilidadeResultados(nome){
      const r=document.getElementById("divRanking"),v=document.getElementById("divVotantes");
      const show=podeVerResultados(nome);
      r.style.display=v.style.display=show?"block":"none";
    }

    const pwModal=document.getElementById("pwModal");
    const pwInput=document.getElementById("pwInput");
    document.getElementById("pwCancel").onclick=()=>{pwModal.style.display="none";document.getElementById("nomeVotante").value="";};
    document.getElementById("pwSubmit").onclick=async()=>{
      const nome=document.getElementById("nomeVotante").value;
      if(pwInput.value===SENHA&&casaisAutorizados.includes(nome)){
        sessionStorage.setItem("auth_"+nome,"1");
        pwModal.style.display="none";
        const {votos,votantes}=await carregarVotos();
        atualizarListas(votos,votantes);
        atualizarVisibilidadeResultados(nome);
      }else alert("Senha incorreta.");
    };

    document.getElementById("nomeVotante").addEventListener("change",async function(){
      const nome=this.value;
      atualizarOpcoesParaVotante(nome);
      if(casaisAutorizados.includes(nome)&&sessionStorage.getItem("auth_"+nome)!=="1"){
        pwModal.style.display="flex";
        atualizarVisibilidadeResultados(null);
      }else{
        atualizarVisibilidadeResultados(nome);
        if(podeVerResultados(nome)){const {votos,votantes}=await carregarVotos();atualizarListas(votos,votantes);}
      }
    });

    document.getElementById("formVotacao").addEventListener("submit",async e=>{
      e.preventDefault();
      const nome=document.getElementById("nomeVotante").value;
      if(!nome)return alert("Selecione seu casal antes de votar!");
      const data=await carregarVotos();
      const votos=data.votos||[],votantes=data.votantes||[];
      if(votantes.includes(nome))return alert("Esse casal jÃ¡ votou hoje!");
      const voto={};
      categorias.forEach(c=>voto[c]=document.getElementById(c).value||null);
      if(Object.values(voto).includes(nome))return alert("VocÃª nÃ£o pode votar em si mesmo!");
      votos.push(voto);
      votantes.push(nome);
      const ok=await salvarVotos(votos,votantes);
      if(!ok)return alert("Erro ao salvar voto.");
      alert("Voto registrado com sucesso!");
      e.target.reset();
      categorias.forEach(id=>{const sel=document.getElementById(id);sel.selectedIndex=0;});
      document.getElementById("nomeVotante").value="";
      atualizarOpcoesParaVotante(null);
      atualizarVisibilidadeResultados(null);
    });

    (async function init(){
      preencherSelects();
      atualizarVisibilidadeResultados(null);
    })();
  </script>
</body>
</html>
